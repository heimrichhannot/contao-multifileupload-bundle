var MultiFileUpload,rawurlencode=function(a){a=(a+"");return encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},__extends=function(c,b){for(var a in c){if(c.hasOwnProperty(a)){b[a]=c[a]}}return b},__getField=function(b,c){var a=b.element.querySelectorAll('input[name="'+(typeof c!=="undefined"?c+"_":"")+b.options.paramName+'"]');if(typeof a!=="undefined"){return a[0]}return"undefined"},__registerOnClick=function(a,b){if(typeof b==="undefined"){return false}a.previewElement.setAttribute("onclick",b);a.previewElement.className=""+a.previewElement.className+" has-info"},camelize=function(a){return a.replace(/[\-_](\w)/g,function(b){return b.charAt(1).toUpperCase()})},__submitOnChange=function(a,c){if(c){if(c==="this.form.submit()"){document.createElement("form").submit.call(__getField(a).form);return}var b=Function(c);b()}},__defaults={init:function(){this.on("thumbnail",function(e,f){if(e.width<this.options.minImageWidth||e.height<this.options.minImageHeight){if(typeof e.rejectDimensions==="function"){e.rejectDimensions()}}else{if(typeof e.acceptDimensions==="function"){e.acceptDimensions()}}}).on("removedfile",function(j){if(j.accepted){var g=__getField(this,"uploaded"),f=__getField(this,"deleted"),i=__getField(this);if(typeof g!=="undefined"&&typeof j.uuid!=="undefined"){var k=JSON.parse(g.value);g.value=JSON.stringify(utilsBundle.array.removeFromArray(j.uuid,k))}if(typeof i!=="undefined"&&typeof j.uuid!=="undefined"){var e=JSON.parse(i.value);i.value=JSON.stringify(utilsBundle.array.removeFromArray(j.uuid,e))}if(typeof f!=="undefined"&&typeof j.uuid!=="undefined"){var h=JSON.parse(f.value);h.push(j.uuid);f.value=JSON.stringify(h)}if(this.files.length<1){this.element.classList.remove("dz-has-files")}if(this.options.maxFiles>1){__submitOnChange(this,this.options.onchange)}}}).on("success",function(k,g){if(typeof g.result==="undefined"){b.emit("error",k,b.options.dictResponseError.replace("{{statusCode}}",": Empty response"),g);return}b.options.url=utilsBundle.url.addParameterToUri(b.options.url,"ato",g.token);g=g.result.data;if(g.result==="undefined"){return false}var f=__getField(this,"uploaded"),h=__getField(this);if(g instanceof Array){for(var j=0,e=g.length;j<e;j++){if((objHandler=l(k,g[j]))!==false){k=objHandler;m(k,f,h);if(k.dataURL){b.emit("thumbnail",k,k.dataURL)}__registerOnClick(k,k.info);break}}}else{if((objHandler=l(k,g))!==false){k=objHandler;m(k,f,h);if(k.dataURL){b.emit("thumbnail",k,k.dataURL)}__registerOnClick(k,k.info)}}__submitOnChange(b,b.options.onchange);function m(p,n,o){if(typeof n!=="undefined"){try{var r=JSON.parse(n.value)}catch(q){return false}r.push(p.uuid);n.value=JSON.stringify(r)}if(typeof o!=="undefined"){try{var i=JSON.parse(o.value)}catch(q){return false}i.push(p.uuid);o.value=JSON.stringify(i)}}function l(n,i){if(i.error){b.emit("error",n,i.error,i);return false}if(i.filenameOrigEncoded===rawurlencode(n.name)&&i.uuid!=="undefined"){n.serverFileName=i.filename;n.uuid=i.uuid;n.url=i.url;n.info=i.info;n.sanitizedName=i.filenameSanitized;n.previewElement.querySelector("[data-dz-name]").innerHTML=i.filenameSanitized;return n}return false}}).on("error",function(g,j,l){var k=g.previewElement.parentNode.querySelectorAll(".dz-error-show");if(k){for(var f=0,e=k.length;f<e;f++){var h=k[f];h.classList.remove("dz-error-show")}}g.previewElement.classList.remove("dz-success");g.previewElement.classList.add("dz-error-show");g.previewElement.addEventListener("mouseleave",function(){this.classList.remove("dz-error-show")})}).on("sending",function(j,m,l){var k=__getField(this).form;l.append("action",this.options.uploadAction);l.append("requestToken",this.options.requestToken);l.append("FORM_SUBMIT",k.id);l.append("field",this.options.paramName);var f=k.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var h=0,e=f.length;h<e;h++){var g=f[h];l.append(g.name,g.value)}}).on("addedfile",function(e){if(this.files.length>0){this.element.classList.add("dz-has-files")}});var d=__getField(this,"formattedInitial"),b=this;if(typeof d!=="undefined"){d=d.value}if(typeof d!=="undefined"&&d!==""){mocks=JSON.parse(d);for(var c=0;c<mocks.length;c++){var a=mocks[c];a.accepted=true;this.files.push(a);this.emit("addedfile",a);if(a.dataURL){this.emit("thumbnail",a,a.dataURL)}__registerOnClick(a,a.info);this.emit("complete",a)}if(this.files.length>0){this.element.classList.add("dz-has-files")}}},};MultiFileUpload={init:function(){Dropzone.autoDiscover=false;this.registerFields()},registerFields:function(){var k=document.querySelectorAll(".multifileupload");for(var h=0,l=k.length;h<l;h++){var o=k[h];if(typeof o.dropzone!=="undefined"){continue}var f=o.attributes,b=f.length,g=o.dataset;if(typeof g==="undefined"){g={};for(;b--;){if(/^data-.*/.test(f[b].name)){var p=camelize(f[b].name.replace("data-",""));g[p]=f[b].value}}}function m(j,i,n){return j.split(i).join(n)}var c=["dictFileTooBig","dictResponseError"];for(var e=0;e<c.length;e++){g[c[e]]=m(g[c[e]],"{.{","{{");g[c[e]]=m(g[c[e]],"}.}","}}")}var a=__extends(g,__defaults);a.url=location.href;if(utilsBundle.util.isTruthy(history.state)&&utilsBundle.util.isTruthy(history.state.url)){a.url=history.state.url}if(a.uploadActionParams){var d=utilsBundle.url.parseQueryString(a.uploadActionParams);a.url=UtilsBundle.url.addParametersToUri(a.url,d)}new Dropzone(o,a)}},};if(window.jQuery){jQuery(document).ready(function(){MultiFileUpload.init()});jQuery(document).ajaxComplete(function(){MultiFileUpload.init()})}if(window.MooTools){window.addEvent("domready",function(){MultiFileUpload.init()});window.addEvent("ajax_change",function(){MultiFileUpload.init()})};